(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7411b55b"],{"0548":function(e,a,t){},"4e19":function(e,a,t){},"68bf":function(e,a,t){"use strict";t.r(a);var l=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"main clearfix",style:{"margin-left":e.$store.state.app.isCollapse?"84px":"240px"}},[t("div",{staticClass:"main_container"},[t("querys",{attrs:{showSwitch:!0},on:{changeQuery:e.changeQuery}},[t("div",{attrs:{slot:"queryTabs"},slot:"queryTabs"},[t("div",{staticClass:"query_tab"},[t("div",{staticClass:"query_label"},[e._v("项目名称")]),t("div",{staticClass:"query_select"},[t("el-input",{attrs:{size:"small",placeholder:"请输入关键词"}})],1)]),t("div",{staticClass:"query_tab"},[t("div",{staticClass:"query_label"},[e._v("专项类别")]),t("div",{staticClass:"query_select"},[void 0!=e.selectParamDict?t("el-select",{attrs:{placeholder:"请选择",size:"small",clearable:""},on:{change:e.selectItem},model:{value:e.param.voltLevel,callback:function(a){e.$set(e.param,"voltLevel",a)},expression:"param.voltLevel"}},e._l(e.selectParamDict.get("voltLevel"),(function(e){return t("el-option",{key:e.codeValue,attrs:{label:e.codeName,value:e.codeValue}})})),1):e._e()],1)]),t("div",{staticClass:"query_tab"},[t("div",{staticClass:"query_label"},[e._v("批次")]),t("div",{staticClass:"query_select"},[void 0!=e.selectParamDict?t("el-select",{attrs:{placeholder:"请选择",size:"small",clearable:""},on:{change:e.selectItem},model:{value:e.param.voltLevel,callback:function(a){e.$set(e.param,"voltLevel",a)},expression:"param.voltLevel"}},e._l(e.selectParamDict.get("voltLevel"),(function(e){return t("el-option",{key:e.codeValue,attrs:{label:e.codeName,value:e.codeValue}})})),1):e._e()],1)]),t("div",{staticClass:"query_tab"},[t("div",{staticClass:"query_label"},[e._v("时间")]),t("div",{staticClass:"query_select"},[t("el-date-picker",{attrs:{size:"small",placeholder:"选择时间"},on:{change:e.selectItem},model:{value:e.param.ghYear,callback:function(a){e.$set(e.param,"ghYear",a)},expression:"param.ghYear"}})],1)])]),t("div",{attrs:{slot:"queryBtns"},slot:"queryBtns"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.exportTmp}},[e._v("新增")]),t("el-button",{attrs:{type:"primary",size:"small",loading:e.editLoading},on:{click:e.editSomePlan}},[e._v("删除")]),t("el-button",{attrs:{type:"primary",size:"small",loading:e.statusLoading},on:{click:e.changeFeaStatus}},[e._v("发布")])],1)]),t("div",{staticClass:"table-item-box"},[t("div",{class:e.showDrawer?"table-wrapper-run":"table-wrapper-init"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"itemTable",attrs:{data:e.tableDataShow,height:e.tableHeight,border:"","header-cell-style":{background:"#359691",color:"#fff"},"cell-class-name":"column","row-class-name":e.tableRowClassName,"highlight-current-row":!0,"row-key":e.getRowKeys,lazy:"",load:e.loadChildren},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection","reserve-selection":!0,width:"45"}}),t("el-table-column",{attrs:{type:"index",width:"50",label:"序号"}}),e._l(e.tableLabel,(function(a,l){return"itemName"!=a.colDname&&1==a.showType?t("el-table-column",{key:l,attrs:{prop:a.colDname,label:a.dispName,"show-overflow-tooltip":!0,"min-width":"150"}}):"itemName"==a.colDname?t("el-table-column",{attrs:{align:"left",label:a.dispName,"show-overflow-tooltip":!0,"min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticClass:"blue",on:{click:function(t){return e.showDetailDialog(a.row)}}},[e._v(e._s(a.row.itemName))])]}}])}):e._e()})),t("el-table-column",{attrs:{label:"操作","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticClass:"blue",on:{click:function(t){return e.showSubmitPlan(a.row)}}},[e._v("添加联系人")]),t("span",{staticClass:"blue",on:{click:function(t){return e.showSubmitPlan(a.row)}}},[e._v("查看联系人")]),t("span",{staticClass:"blue",on:{click:function(t){return e.showSubmitPlan(a.row)}}},[e._v("修改可研")])]}}])})],2),t("div",{staticClass:"page"},[t("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,30,50],"page-size":20,layout:"sizes, total, prev, pager, next, jumper",total:e.totalNum},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),t("div",{class:e.showDrawer?"item-add-wrapper-run":"item-wrapper-init"},[e.showDrawer?t("item-add-com",{key:e.timer,attrs:{showData:e.showData,showAddDialog:e.showDrawer,isShowQuery:e.showQuery,tableHeightTab:e.tableHeight},on:{changeStatus:e.changeStatus}}):e._e()],1)])],1),t("el-dialog",{staticClass:"compile-dialog",attrs:{visible:e.dialogFormVisible,"close-on-click-modal":!1,"custom-class":"cus-dialog","modal-append-to-body":!1},on:{"update:visible":function(a){e.dialogFormVisible=a}}},[t("template",{slot:"title"},[t("div",{staticStyle:{"font-size":"large"}},[t("span",[e._v("添加联系人")])])]),t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],ref:"lableFormQuestion1",attrs:{model:e.planLabel,inline:!0,"label-position":"right"}},e._l(e.planLabel,(function(a,l){return"DATE"!=a.dispType?t("el-form-item",{key:a.colDname,class:"DATE"==a.dispType?"":"el-form-item-input",attrs:{label:a.dispName,"label-width":e.formLabelWidth1,prop:l+".value",rules:a.rule}},["test"==a.dispType&&"questionCode"!=a.colDname?t("el-input",{staticClass:"diy",attrs:{placeholder:a.dispName},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"domain.value"}}):e._e(),"string"==a.dispType||null==a.dispType?t("el-input",{attrs:{autocomplete:"off",placeholder:a.dispName},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"domain.value"}}):e._e()],1):e._e()})),1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(a){return e.cancelSumbmitPlan()}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:function(a){return e.submitPlan()}}},[e._v("保 存")])],1)],2)],1)},s=[],i=(t("4160"),t("4ec9"),t("4fad"),t("b64b"),t("d3b7"),t("ac1f"),t("25f0"),t("3ca3"),t("1276"),t("159b"),t("ddb0"),t("3835")),n=t("5530"),o=t("2f62"),r=(t("2bb5"),t("a960")),c=t("c2b4"),u=t("7e1e"),d=t("73fc"),m={name:"planHookUp",data:function(){var e=this;return{editLoading:!1,statusLoading:!1,submitLoading:!1,isEdit:!1,editData:{itemId:[]},timer:"",showAddDialog:!1,showData:{itemId:null,specClass:"",specClassName:"",oldPath:"",tableLabelArr:"",phash:"1",parentItemId:null},showDrawer:!1,userId:"",token:"",createOrg:"",isClearable:!0,isAccordion:!0,valueId:"",props:{value:"id",label:"name",children:"children",code:"createOrg"},deptArr:[],showQuery:!1,isShowQuery:!1,dialogVisibleL:!1,dialogLoading:!1,loading:!1,delData:{ids:[]},lableList:[{value:""}],totalNum:0,currentPage:1,currentNum:20,year:"",dialogFormVisible:!1,form:{},options:[],value:"",formLabelWidth:"33%",formLabelWidth1:"50%",input:"",tableData:[],tableLabel:[],param:{createOrg:"",index:1,itemName:"",itemType:"",pageSize:10,speciality:"",voltLevel:"",itemPhase:1,itemPhaseDet:"26",ghYear:"",itemSource:"",planStatus:""},dictMap:new Map,selectParamDict:new Map,tableDataShow:[],saveData:{kssj:""},pleanTableLabel:[],planLabel:{},tempItemId:"",tempItemName:"",itemShow:!1,saveLabel:{},reportFileName:"",columnTypeMap:new Map,isShowFilter:!1,tableHeight:"",tableHeightTab:"",minDate:"",maxDate:"",pickerOptionsStart:{disabledDate:function(a){var t=new Date(e.maxDate),l=Date.now()-864e5;return a.getTime()<=l||a.getTime()>t}},pickerOptionsEnd:{disabledDate:function(a){var t=new Date(e.minDate),l=Date.now()-864e5;return a.getTime()<=l||a.getTime()<=t}},auditPlanId:"",saveParams:[],userSpecialityArr:[]}},components:{querys:d["a"],SelectTree:r["a"],ItemAddCom:c["default"]},created:function(){this.tableHeight=window.innerHeight-190},mounted:function(){this.getItemLabel(),this.getSpecialityIds(),this.getTable(1,20),this.userId=sessionStorage.getItem("userId"),this.token=sessionStorage.getItem("token")},computed:Object(n["a"])({},Object(o["b"])([])),watch:{deptCode:function(){this.param.createOrg=this.createOrg,this.currentPage=1,this.getTable(1,this.currentNum)}},methods:{loadChildren:function(e,a,t){},editSomePlan:function(){var e=this;e.isEdit=!0,e.editData.itemId.length>0?(e.dialogFormVisible=!0,e.editLoading=!0,Object(u["gc"])().then((function(a){if(e.editLoading=!1,console.log("response",a),a.data.successful){e.pleanTableLabel=a.data.resultValue.items,e.pleanTableLabel.forEach((function(a){e.$set(a,"value","")}));var t={};for(var l in e.pleanTableLabel){var s=a.data.resultValue.items[l];if(t[l]=s,1==s.isMandatory){var i=new Object;i.required=!0,i.message=s.dispName+"不能为空",i.trigger="blur",t[l].rule=i}else{var n=new Object;n.required=!1,t[l].rule=n}if("mgtUserTel"==s.colDname||"actUserTel"==s.colDname){var o=new Object;o.required=!1,o.validator=e.validaMobile,o.message="手机号格式不正确",o.trigger="blur",t[l].rule=o}}e.planLabel=t}e.loading=!1})).catch((function(e){console.log(e)}))):e.$message({showClose:!0,message:"请选择至少一条数据进行编辑",type:"warning"})},validaMobile:function(e,a,t){var l=/^(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8}$/;a?l.test(a)?t():t(new Error("手机号格式不正确")):t()},getItemLabel:function(){var e=this;Object(u["Vc"])().then((function(a){if(console.log("response",a),a.data.successful){a.data.resultValue.tableLable;e.selectParamDict.set("voltLevel",a.data.resultValue.voltCodeList),e.selectParamDict.set("itemLevel",a.data.resultValue.itemLevelList),e.selectParamDict.set("itemSource",a.data.resultValue.itemSourceList),e.$forceUpdate()}}))},changeStatus:function(e){this.showDrawer=e,console.log("status"+e)},showDetailDialog:function(e){this.showData.itemId=e.itemId,this.showData.phash=0,this.showDrawer=!0,this.timer=(new Date).getTime()},exportTmp:function(){var e=this;if(e.delData.ids.length){var a=e.delData;a.ids=a.ids.toString(),window.location.href=e.GLOBALURL+"/prjStOnAuditPlan/planToExcel?ids="+a.ids+"&token="+e.token}else e.$message({showClose:!0,message:"请选择至少一条数据",type:"warning"})},getValue:function(e){this.createOrg=e},getTreeDeptCode:function(){var e=this;Object(u["jc"])().then((function(a){var t=a.data.resultValue;Object(u["hc"])().then((function(a){console.log(a),a.data.successful&&(e.valueId=t,e.deptArr=a.data.resultValue)}))}))},changeQuery:function(e,a){e?(this.tableHeight=a-50,this.isShowQuery=!0,this.showQuery=!0):(this.tableHeight=a-50,this.isShowQuery=!1,this.showQuery=!1)},getSpecialityIds:function(){var e=this;Object(u["dc"])().then((function(a){if(a.data.successful){var t=a.data.resultValue;""!=t&&(e.userSpecialityArr=t.split(",")),console.log(a)}}))},changeFeaStatus:function(){var e=this,a=this;if(0==a.saveParams.length)return this.$message({showClose:!0,message:"请选择要提交的项目",type:"warning"}),!1;for(var t=0;t<a.saveParams.length;t++)if(0==a.saveParams[t].havePlan)return this.$message({showClose:!0,message:"所选的项目中有未提交计划的数据",type:"warning"}),!1;console.log(a.saveParams),a.statusLoading=!0,Object(u["m"])(a.saveParams).then((function(t){a.statusLoading=!1,t.data.successful?(e.$message.success("提交评审计划成功"),a.getTable(a.currentPage,a.currentNum),a.saveParams=[],a.$refs.itemTable.clearSelection()):e.$message.error("提交评审计划失败·")}))},getRowKeys:function(e){return e.itemId},formartDate:function(e){var a=new Date(e),t=a.getFullYear(),l=a.getMonth()+1,s=a.getDate();return t+"-"+this.add0(l)+"-"+this.add0(s)},add0:function(e){return e<10?"0"+e:e},tableRowClassName:function(e){var a=e.row;e.rowIndex;return 1==a.havePlan?"success-row":""},uploadSuccess:function(e){var a=this;if(this.fileUploadLoading=!1,e.successful)this.$message({showClose:!0,message:"上传成功",type:"success"}),a.tzkeVisible1=!1,a.fileList=[],this.currentPage=1,this.getTable(1,a.currentNum);else{var t=e.resultHint;this.$message({showClose:!0,message:"上传失败 "+t,dangerouslyUseHTMLString:!0,type:"error"})}},changeStartDate:function(e){null!=e&&(null!=this.planLabel.planEndDate&&(this.maxDate=this.planLabel.planEndDate),this.minDate=e)},changeEndDate:function(e){null!=e&&(this.maxDate=e)},switchFilter:function(){this.isShowFilter=!this.isShowFilter},getColumnTypeArr:function(e){for(var a=new Map,t=0;t<e.length;t++){var l=e[t];a.set(l.colDname,l.colType)}return a},selectItem:function(){this.currentPage=1,this.getTable(1,this.currentNum)},resetItem:function(){var e=this;e.param={createOrg:"",index:1,itemName:"",itemType:"",pageSize:10,speciality:"",voltLevel:"",feaStatus:0,ghYear:""},this.getTable(1,e.currentNum)},cancelSumbmitPlan:function(){var e=this;e.dialogFormVisible=!1,e.minDate="",e.maxDate=""},submitPlan:function(){var e=this,a=this;a.$refs["lableFormQuestion1"].validate((function(t){if(!t)return console.log("error submit!!"),!1;var l={items:[]},s={},i=a.editData;i.itemId=i.itemId.toString(),Object.keys(a.planLabel).forEach((function(e){console.log(e,a.planLabel[e]),s[a.planLabel[e].colDname]=a.planLabel[e].value})),1==a.isEdit?s["itemId"]=i.itemId:(s["itemId"]=a.tempItemId,""!=a.auditPlanId&&(s["auditPlanId"]=a.auditPlanId)),l.items.push(s),a.dialogFormVisible=!1,a.submitLoading=!0,Object(u["Jd"])(l).then((function(t){console.log(t),a.submitLoading=!1,t.data.successful?(e.$message({showClose:!0,message:"保存成功",type:"success"}),a.getTable(a.currentPage,a.currentNum),e.$refs.itemTable.clearSelection(),a.minDate="",a.maxDate=""):e.$message({showClose:!0,message:"保存失败",type:"error"}),a.loading=!1})),a.loading=!1}))},showSubmitPlan:function(e){var a=this;a.dialogFormVisible=!0,a.tempItemId=e.itemId,Object(u["gc"])().then((function(t){if(console.log("response",t),t.data.successful){a.pleanTableLabel=t.data.resultValue.items,a.pleanTableLabel.forEach((function(e){a.$set(e,"value","")}));var l={};for(var s in a.pleanTableLabel){var i=t.data.resultValue.items[s];if(l[s]=i,1==i.isMandatory){var n=new Object;n.required=!0,n.message=i.dispName+"不能为空",n.trigger="blur",l[s].rule=n}else{var o=new Object;o.required=!1,l[s].rule=o}if("mgtUserTel"==i.colDname||"actUserTel"==i.colDname){var r=new Object;r.required=!1,r.validator=a.validaMobile,r.message="手机号格式不正确",r.trigger="blur",l[s].rule=r}}1==e.havePlan&&Object(u["hb"])(e.itemId).then((function(e){if(e.data.successful){var t=e.data.resultValue;for(var s in l){var i=l[s];if(i.value=t[i.colDname],"planEndDate"==i.colDname||"planStartDate"==i.colDname){var n=t[i.colDname];i.value=a.formartDate(n)}else i.value=t[i.colDname];l[s]=i}a.auditPlanId=t.auditPlanId}})),a.planLabel=l}a.loading=!1})).catch((function(e){console.log(e)}))},updateItem:function(){this.dialogFormVisible1=!0},handleSelectionChange:function(e){var a=this;a.editData={itemId:[]},a.saveParams=[],a.delData={ids:[]},e.forEach((function(e,t){a.delData.ids.push(e.itemId),a.editData.itemId.push(e.itemId)})),e.forEach((function(e){var t={};t.itemId=e.itemId,t.auditPlanId=e.auditPlanId,t.havePlan=e.havePlan,a.saveParams.push(t)}))},del:function(){var e=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$message({showClose:!0,message:"删除成功",type:"success"})})).catch((function(){e.$message({type:"warning",message:"已取消删除"})}))},submitForm:function(e){var a=this,t=this;t.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var l={items:[]};console.log(t.lableList);var s={};t.lableList.forEach((function(e,a){s[e.colDname]=e.value})),l.items.push(s),t.dialogFormVisible=!1,t.loading=!0,Object(u["pd"])(l).then((function(e){console.log(e),e.data.successful?(a.$message({showClose:!0,message:"添加成功",type:"success"}),t.getTable(t.currentPage,t.currentNum)):a.$message({showClose:!0,message:"添加失败",type:"error"}),t.loading=!1}))}))},showDialog:function(){var e=this;e.dialogFormVisible=!0,e.dialogLoading=!0,Object(u["ac"])().then((function(a){console.log(a),a.data.successful&&(a.data.resultValue.items.forEach((function(e,a){e.value=""})),e.lableList=a.data.resultValue.items),e.dialogLoading=!1}))},handleSizeChange:function(e){console.log("每页 ".concat(e," 条")),this.currentNum=e,this.getTable(this.currentPage,e)},handleCurrentChange:function(e){console.log("当前页: ".concat(e)),this.currentPage=e,this.getTable(e,this.currentNum)},getTable:function(e,a){var t=this;t.loading=!0,t.param.index=e,t.param.pageSize=a,t.param.planStatus=2,Object(u["Hc"])(t.param).then((function(e){console.log("response",e),e.data.successful&&(t.totalNum=e.data.resultValue.totalNum,t.tableLabel=e.data.resultValue.tableLable,t.dictMap=t.getDictArr(t.tableLabel),t.saveLabel=t.getLabelList(t.tableLabel),t.columnTypeMap=t.getColumnTypeArr(t.tableLabel),t.tableData=e.data.resultValue.tableData,t.tableDataShow=t.getShowDateTable(t.tableData,t.dictMap,t.columnTypeMap)),t.loading=!1})).catch((function(e){console.log(e)}))},getLabelList:function(e){var a=this;e.forEach((function(e){a.$set(e,"value","")}));var t={};for(var l in e)t[l]=e[l];return t},getDictArr:function(e){for(var a=this,t=new Map,l=0;l<e.length;l++){var s=e[l];if(null!=s.codeList){if("speciality"==s.colDname){for(var i=[],n=0;n<s.codeList.length;n++)for(var o=0;o<a.userSpecialityArr.length;o++)s.codeList[n].codeValue==a.userSpecialityArr[o]&&i.push(s.codeList[n]);s.codeList=i}t.set(s.colDname,s.codeList)}}return t},getShowDateTable:function(e,a,t){for(var l=this,s=[],n=0;n<e.length;n++){for(var o=e[n],r=new Object,c=0,u=Object.entries(o);c<u.length;c++){var d=Object(i["a"])(u[c],2),m=d[0],g=d[1];if(console.log(m+":"+g),a.has(m))for(var h=a.get(m),b=0;b<h.length;b++){var p=h[b];p.codeValue==g&&(r[m]=p.codeName)}else if("DATE"==t.get(m)){r[m+"Rel"]=g;var f=l.formartDate(g);r[m]=f}else r[m]=g;"createOrg"==m&&(r["createOrg"]=g)}s.push(r)}return s}}},g=m,h=(t("cbd2"),t("bc52"),t("2877")),b=Object(h["a"])(g,l,s,!1,null,"76b89b7d",null);a["default"]=b.exports},bc52:function(e,a,t){"use strict";var l=t("0548"),s=t.n(l);s.a},cbd2:function(e,a,t){"use strict";var l=t("4e19"),s=t.n(l);s.a}}]);
//# sourceMappingURL=chunk-7411b55b.4f5dcc11.js.map